<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
    </style>
  </head>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script src="js/webpd-latest.js"></script>

  <script>
    // ***BEGIN AUDIO SETUP***
    var patch;
    $.get('patches/SP4.pd', function(patchStr)  {
      patch = Pd.loadPatch(patchStr);
      Pd.start()
    });

    // Communicates a message to a receiver object receiverName in the audio patch
    function audioMessage(receiverName, message)  {
      Pd.send(receiverName, [message]);
    }

    // Communicates an array of messages messageArray to a receiver object receiverName in the audio patch
    function audioMessageList(receiverName, messageArray)  {
      Pd.send(receiverName, messageArray);
    }
    // ***END AUDIO SETUP***


    $(function () {
      var socket = io();
      //and the socket will let us grab messages
      //from the server and display them here
      socket.on('chat message', function(msg){
        //ok this is where the events will be processed
        //msg will be _# depending on the id
        console.log(msg);
        $('#messages').append($('<li>').text(msg));
      });
    });

	// If you're ever looking to interface with the audio patch, here are some tips:
	//
	// Use audioMessage(receiverName, message) to send a message to a specific object.
        //
	// Use audioMessageList(receiverName, messageArray) in the rare case that you need
        //  to send a multipart message to an object (I don't foresee this happening yet).
        //
        // Proposed messages:
        //   audioMessage("button<#>", <effect>)
        //     - <#>: the number of the button that was pressed by some controller
        //     - <effect>: a double (positive or negative) specifying the impact of the
        //       button press, where more positive is better and more negative is worse
        //
        //   audioMessage("stage", <stageNumber>)
        //     - <stageNumber>: the number of the stage just entered (1-11, where 11
        //       indicates victory)
        //
        // If you think aanything is missing or if anything needs clarification here,
        //  feel free to reach out!
        //
        // - Jacob <3

  </script>

  <body>
    <ul id="messages"></ul>
  </body>
</html>
